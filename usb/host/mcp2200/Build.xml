<?xml version="1.0" encoding="UTF-8"?>
<project default="mcp2200cli" name="MCP2200">
	
	<!-- ================================= 
          target: mcp2200cli              
         ================================= -->
    <target name="mcp2200cli" depends="BuildWindows, BuildUnix" description="MCP2200 Command line interface">
        <echo>done.</echo>
    </target>
	
	<filelist dir="src" id="sourcefiles">
		<file name="mcp2200.c"/>
		<file name="mcp2200cli.c"/>
	</filelist>
	<mapper id="objectfiles" type="glob" from="*.c" to="bin/*.o">
	</mapper>
	<pathconvert pathsep=" " property="objects">
		<mapper type="glob" from="${basedir}${file.separator}src${file.separator}*.c" to="bin/*.o"></mapper>
		<filelist refid="sourcefiles" />
	</pathconvert>
	
	<condition property="isWin32" value="true">
		<os family="windows"/>
	</condition>
			
	<condition property="isUnix" value="true">
		<os family="unix"/>
	</condition>
	
	<target name="BuildWindows" if="isWin32">
		<echo>Build for win32</echo>
		<mkdir dir="bin"/>
		<apply executable="gcc">
			<arg value="-c"/>
			<arg value="-Wall"/>
			<arg value="-Iinclude/win32"/>
			<arg value="-o"/><targetfile/>
			<srcfile/>
			<filelist refid="sourcefiles"/>
			<mapper refid="objectfiles" />
		</apply>
		<exec executable="gcc">
			<arg value="-Wall"/>
			<arg value="-o"/><arg value="bin/mcp2200cli.exe"/>			
			
			<arg line="${objects}"/>
			<arg value="lib/win32/libusb-1.0.a"/>
		</exec>
	</target>
	
	<target name="BuildUnix" if="isUnix">
		<echo>Build for Unix</echo>
		<mkdir dir="bin"/>
		<apply executable="gcc">
			<arg value="-c"/>
			<arg value="-Wall"/>
			<arg value="-I/usr/include/libusb-1.0"/>
			<arg value="-o"/><targetfile/>
			<srcfile/>
			<filelist refid="sourcefiles"/>
			<mapper refid="objectfiles" />
		</apply>
		<exec executable="gcc">
			<arg value="-Wall"/>
			<arg value="-o"/><arg value="bin/mcp2200cli"/>			
			
			<arg line="${objects}"/>
			<arg value="-lusb-1.0"/>
			<arg value="-lrt"/>
			<arg value="-lpthread"/>
		</exec>
	</target>
	
</project>